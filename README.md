# ATS Monitoring
An application for sending notifications via the SMS gateway API and recording events in the PostgreSQL DBMS about the status of the ATS (city power grid, generator, UPS)

[Diagram](https://viewer.diagrams.net/?tags=%7B%7D&highlight=0000ff&edit=_blank&layers=1&nav=1&title=diagram%20ats-monitoring.drawio.xml#R7Vtbd5s4EP41eUyPAIOdx9hO0uwmW7fOtttHGRSsBhArhO3k13cEwhgDjuN7Gs7xSazRfTTzzafBnBk9f3bDcTi%2BZw7xznTkzM6M%2Fpmuazoy4J%2BUPCuJprVSicupo2S5YEhfiBIiJY2pQ6JCQ8GYJ2hYFNosCIgtCjLMOZsWmz0yrzhriF1SEgxt7JWlP6gjxtk2EMorPhPqjtXUHVNVjLD95HIWB2q%2BgAUkrfFxNoxqGo2xw6YLIuPqzOhxxkT6zZ%2F1iCf1mmks7XddUztfMieBWKdDRGPXfelfv4zbo67f5W7v61%2FnF%2BkoE%2BzFShVqseI50w1xQFWqyLgYM5cF2LvKpd1k%2F0ROg6CUt7ljLAShBsJfRIhnde44FgxEY%2BF7qvaRBUJVahaUy1tTu41YzG21LuNCMxHptDqPmtlpIfs8MxzMXSJW7FmZptzXwuBKaTeE%2BUTwZ2jAiYcFnRRNBCtLc%2BftcpXDF6X16hOoW3FB%2B5YHa%2B86dFI4Bev%2FWNpJoqnzKFHVJTQAJc3ySrk8j7pBoYcNOiR8sZHlqv9eNuImU6Wj3AZhLLs7NBKcjmJBWSCLZELhnNQUoJd0luLMIE62mUmX7G5CuKDgopdqS0IaUzfboNqW0Y1CbNPAfUhMrZML7sijNAI9l3xT%2FqslsjEO5UR2PJImHCnrQ4nuOWCM3IjRB4OTbpxaqFpbq2i8Reufe7ks2Myntvru4RHxunO46DGPwfL7CWBAN8HZ0xx7Mp%2B4xj71JKZ%2BJ9zBAV5yFb3WT6TuyGyldefgnXZR0N1WxWkOg4ahZOMFBJzD2jYOUemeeq1ThJV26oO%2F0yA1UkvaKEL5361cY1TnK1n8yjpq9WOA7QXruJdmVbnX5cNwwVvSsUpOVONbpdWDLFyWjXmlZjzpPLV7SsHprb1ib1ni0U3BqFpbAzaVx4miOAzBbV7VUHn%2BXa%2FohgSEY8H4KSzm38HwFJYxuANcQAM6kyTy7csBYdmSXgklmakmBgoMBeDx0UtQ%2BpFKcFqEc4ez8CGjEGgVGXkDyF6YBZDVjDLKap0KlJ033DnKasb7ZX6rWN2r7E%2FTjkX%2FVi27lgIemtD9oOnoyMXcIUFD4d4fhTOso3M4cwsOl7K3lLOl8vPEbnJ%2Bl9aBdsS5siVZtzGb2yyM9aARZ1ITNh7RgIgNGNmIr8vR3gkBS0L7A6e%2BeQpM4%2Fs%2FcjkR4RPCV6r8Q5GPln588oFK%2BOAzZxRH0np6AxjzdlDSo%2FT3quixiOtSZctBx6eOk5CVYlQxylHFmKP4ErRzJrDAo%2FkUIYMomSjF7MIHdtNDn8wzE5bZg7KWl%2BEjm3MBcAFDY5ocI8GRmJIoM%2BS1CND6B65fLMUDreLAK%2BOBta%2Fzbv9hZFNbN9eomcdim%2Fe9b%2F0AUeR1f%2Bkt7%2B%2Bvnv%2Fz8%2FlpnAOomz%2F%2FJ%2FuDk6jiz8W6%2FkwNnpaeF0sDAuGFJK6%2FgJBL%2Bt3dqVaq8ag3Bq0%2Ba7wd9R%2BqQIk4Y35tdGwo%2FglQfMs8OsXP9vU%2BOP7BMrZ3DJxhPda5p3RumfRvupd98fI7cNyE630ZSNvr9692TNNzyYBFwuVk%2BPVu5cirhkhy8OieBVQwDgD1xoGWrgyndjmw2p%2BK14N2BVvUDfOg14NyUqy5HuztemCho18P6tNFWyYzGX%2BK4GySh9INnzldPnPROj6fsRo%2BU5Xm9CgJxMqY92F5TJpfnFAy3T1x%2BcJxAFdaHfUhtEj%2BQYM%2Fn3toqCIWHZp8dEo40HCOXXOOzkX5nK09UY7qDE7Vc9ejZiT1zZNZ9TmqdXJZR01I7iuXdTm4hbrhvby6uViQKa7%2FPVDDADdjgCX3rzDUWkQwj5rRqrTFJqFVQwDtpyEJnIYDVgKNbYNbrSbImz5e3j1f285lj5wrWhG%2B9hBBBuPkVY4mZpxuzDhs1qDa%2FJqgscJ5UBD7o%2BYpSPW4Q1%2Fms30SRfLltA8ZPw5836%2F24PIPoZv7%2FrZH3TKLSN2u%2BMF7%2B6D3%2FfIjhpvhfXPAmx6wdbiEDhTzl2STuoW3kI2r3w%3D%3D)

[Manual](https://github.com/stepanov-denis/ats-monitoring/blob/master/ATS%20Monitoring%20manual.pdf)
## Setup
* Install Rust for Linux or macOS
```
$ curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh
```
For Windows, visit [this page](https://www.rust-lang.org/tools/install)
* Clone the repository
* Edit the http get requests
```
let resp = reqwest::blocking::get("https://api-mapper.clicksend.com/http/v2/send.php?method=http&username=development-service@yandex.ru&key=1E82A334-89D8-985C-526B-712DB70A713D&to=+79139402913&message=Сбой+питания+от+электросети.+Успешный+старт+генератора.").unwrap();
```
* Edit the connection configuration strings to PostgreSQL
```
let mut client =
    Client::connect("postgresql://postgres:postgres@localhost/postgres", NoTls)?;
```
* Compile local packages and all their dependencies
```
$ cargo build --release
```
## Setting up the environment
* Install PostgreSQL
* Install ODBC driver for PostgreSQL
* Create the following tables in PostgreSQL:
```
CREATE TABLE avr_control_insert (
    mains_power_supply int NOT NULL,
    start_generator int NOT NULL,
    generator_faulty int NOT NULL,
    generator_work int NOT NULL,
    connection int NOT NULL,
    mark timestamptz default current_timestamp
);
```
```
CREATE TABLE журнал_работы_приложения (
    событие text NOT NULL,
    время_и_дата timestamp default current_timestamp
);
```
```
CREATE TABLE события_авр (
    событие text NOT NULL,
    время_и_дата timestamp default current_timestamp
);
```
* Install [Lectus Modbus OPC/DDE server](http://www.lectussoft.com/) or another OPC server
* In OPC server settings connect an external PostgreSQL DBMS
* Open configuration file "trim5.cfg" in Lectus Modbus OPC/DDE server and edit network addresses. When using another OPC server, configure the modbus variables yourself and create a script for recording the values of modbus variables in PostgreSQL
```
INSERT INTO avr_control_insert (mains_power_supply, start_generator, generator_faulty, generator_work, connection)
    VALUES (Item(trim5.mains_power_supply), Item(trim5.start_generator), Item(trim5.generator_faulty), Item(trim5.generator_work), Item(trim5.connection));
```
* Install [SMLogix](https://segnetics.com/ru/smlogix)
* Upload into PLC Pixel file "ats control.psl" and edit network addresses
* Upload into PLC Trim5 file "winter garden.psl" and edit network addresses
* Install [Orange Data Mining](https://orangedatamining.com/download/#linux)
* [Сonfigure](https://orangedatamining.com/widget-catalog/data/sqltable/) data reading from SQL database
* Create an account on [ClickSend](https://www.clicksend.com/) and top up your balance
* Run PLC Pixel
* Run PLC Trim5
* Run OPC server
* Run PostgreSQL
* Run ATS Monitoring
## Use
* Сreate and save the report in the form you need in Orange Data Mining
* Check your phone for SMS messages from ClickSend
